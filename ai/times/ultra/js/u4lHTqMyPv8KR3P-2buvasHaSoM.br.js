const e={none:"",left:' align="left"',right:' align="right"',center:' align="center"'},t={enter:{table(e){const t=e._align;this.lineEndingIfNeeded(),this.tag("<table>"),this.setData("tableAlign",t)},tableBody(){this.tag("<tbody>")},tableData(){const t=this.getData("tableAlign"),n=this.getData("tableColumn"),i=e[t[n]];void 0===i?this.buffer():(this.lineEndingIfNeeded(),this.tag("<td"+i+">"))},tableHead(){this.lineEndingIfNeeded(),this.tag("<thead>")},tableHeader(){const t=this.getData("tableAlign"),n=this.getData("tableColumn"),i=e[t[n]];this.lineEndingIfNeeded(),this.tag("<th"+i+">")},tableRow(){this.setData("tableColumn",0),this.lineEndingIfNeeded(),this.tag("<tr>")}},exit:{codeTextData(e){let t=this.sliceSerialize(e);this.getData("tableAlign")&&(t=t.replace(/\\([\\|])/g,n)),this.raw(this.encode(t))},table(){this.setData("tableAlign"),this.setData("slurpAllLineEndings"),this.lineEndingIfNeeded(),this.tag("</table>")},tableBody(){this.lineEndingIfNeeded(),this.tag("</tbody>")},tableData(){const e=this.getData("tableAlign"),t=this.getData("tableColumn");t in e?(this.tag("</td>"),this.setData("tableColumn",t+1)):this.resume()},tableHead(){this.lineEndingIfNeeded(),this.tag("</thead>")},tableHeader(){const e=this.getData("tableColumn");this.tag("</th>"),this.setData("tableColumn",e+1)},tableRow(){const t=this.getData("tableAlign");let n=this.getData("tableColumn");for(;n<t.length;)this.lineEndingIfNeeded(),this.tag("<td"+e[t[n]]+"></td>"),n++;this.setData("tableColumn",n),this.lineEndingIfNeeded(),this.tag("</tr>")}}};function n(e,t){return"|"===t?t:e}function i(e){return null!==e&&e<-2}function a(e){return null!==e&&(e<0||32===e)}function l(e){return-2===e||-1===e||32===e}function r(e,t,n,i){const a=i?i-1:Number.POSITIVE_INFINITY;let r=0;return function(i){if(l(i))return e.enter(n),s(i);return t(i)};function s(i){return l(i)&&r++<a?(e.consume(i),s):(e.exit(n),t(i))}}class s{constructor(){this.map=[]}add(e,t,n){!function(e,t,n,i){let a=0;if(0===n&&0===i.length)return;for(;a<e.map.length;){if(e.map[a][0]===t)return e.map[a][1]+=n,void e.map[a][2].push(...i);a+=1}e.map.push([t,n,i])}(this,e,t,n)}consume(e){if(this.map.sort(((e,t)=>e[0]-t[0])),0===this.map.length)return;let t=this.map.length;const n=[];for(;t>0;)t-=1,n.push(e.slice(this.map[t][0]+this.map[t][1])),n.push(this.map[t][2]),e.length=this.map[t][0];n.push([...e]),e.length=0;let i=n.pop();for(;i;)e.push(...i),i=n.pop();this.map.length=0}}function o(e,t){let n=!1;const i=[];for(;t<e.length;){const a=e[t];if(n){if("enter"===a[0])"tableContent"===a[1].type&&i.push("tableDelimiterMarker"===e[t+1][1].type?"left":"none");else if("tableContent"===a[1].type){if("tableDelimiterMarker"===e[t-1][1].type){const e=i.length-1;i[e]="left"===i[e]?"center":"right"}}else if("tableDelimiterRow"===a[1].type)break}else"enter"===a[0]&&"tableDelimiterRow"===a[1].type&&(n=!0);t+=1}return i}const u={flow:{null:{tokenize:function(e,t,n){const s=this;let o,u=0,d=0;return function(e){let t=s.events.length-1;for(;t>-1;){const e=s.events[t][1].type;if("lineEnding"!==e&&"linePrefix"!==e)break;t--}const i=t>-1?s.events[t][1].type:null,a="tableHead"===i||"tableRow"===i?I:c;if(a===I&&s.parser.lazy[s.now().line])return n(e);return a(e)};function c(t){return e.enter("tableHead"),e.enter("tableRow"),function(e){if(124===e)return b(e);return o=!0,d+=1,b(e)}(t)}function b(t){return null===t?n(t):i(t)?d>1?(d=0,s.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),f):n(t):l(t)?r(e,b,"whitespace")(t):(d+=1,o&&(o=!1,u+=1),124===t?(e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),o=!0,b):(e.enter("data"),h(t)))}function h(t){return null===t||124===t||a(t)?(e.exit("data"),b(t)):(e.consume(t),92===t?g:h)}function g(t){return 92===t||124===t?(e.consume(t),h):h(t)}function f(t){return s.interrupt=!1,s.parser.lazy[s.now().line]?n(t):(e.enter("tableDelimiterRow"),o=!1,l(t)?r(e,p,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):p(t))}function p(t){return 45===t||58===t?D(t):124===t?(o=!0,e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),m):C(t)}function m(t){return l(t)?r(e,D,"whitespace")(t):D(t)}function D(t){return 58===t?(d+=1,o=!0,e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),y):45===t?(d+=1,y(t)):null===t||i(t)?w(t):C(t)}function y(t){return 45===t?(e.enter("tableDelimiterFiller"),v(t)):C(t)}function v(t){return 45===t?(e.consume(t),v):58===t?(o=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),x):(e.exit("tableDelimiterFiller"),x(t))}function x(t){return l(t)?r(e,w,"whitespace")(t):w(t)}function w(n){return 124===n?p(n):(null===n||i(n))&&o&&u===d?(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(n)):C(n)}function C(e){return n(e)}function I(t){return e.enter("tableRow"),R(t)}function R(n){return 124===n?(e.enter("tableCellDivider"),e.consume(n),e.exit("tableCellDivider"),R):null===n||i(n)?(e.exit("tableRow"),t(n)):l(n)?r(e,R,"whitespace")(n):(e.enter("data"),E(n))}function E(t){return null===t||124===t||a(t)?(e.exit("data"),R(t)):(e.consume(t),92===t?O:E)}function O(t){return 92===t||124===t?(e.consume(t),E):E(t)}},resolveAll:function(e,t){let n,i,a,l=-1,r=!0,u=0,b=[0,0,0,0],h=[0,0,0,0],g=!1,f=0;const p=new s;for(;++l<e.length;){const s=e[l],o=s[1];"enter"===s[0]?"tableHead"===o.type?(g=!1,0!==f&&(c(p,t,f,n,i),i=void 0,f=0),n={type:"table",start:Object.assign({},o.start),end:Object.assign({},o.end)},p.add(l,0,[["enter",n,t]])):"tableRow"===o.type||"tableDelimiterRow"===o.type?(r=!0,a=void 0,b=[0,0,0,0],h=[0,l+1,0,0],g&&(g=!1,i={type:"tableBody",start:Object.assign({},o.start),end:Object.assign({},o.end)},p.add(l,0,[["enter",i,t]])),u="tableDelimiterRow"===o.type?2:i?3:1):!u||"data"!==o.type&&"tableDelimiterMarker"!==o.type&&"tableDelimiterFiller"!==o.type?"tableCellDivider"===o.type&&(r?r=!1:(0!==b[1]&&(h[0]=h[1],a=d(p,t,b,u,void 0,a)),b=h,h=[b[1],l,0,0])):(r=!1,0===h[2]&&(0!==b[1]&&(h[0]=h[1],a=d(p,t,b,u,void 0,a),b=[0,0,0,0]),h[2]=l)):"tableHead"===o.type?(g=!0,f=l):"tableRow"===o.type||"tableDelimiterRow"===o.type?(f=l,0!==b[1]?(h[0]=h[1],a=d(p,t,b,u,l,a)):0!==h[1]&&(a=d(p,t,h,u,l,a)),u=0):!u||"data"!==o.type&&"tableDelimiterMarker"!==o.type&&"tableDelimiterFiller"!==o.type||(h[3]=l)}0!==f&&c(p,t,f,n,i);p.consume(t.events),l=-1;for(;++l<t.events.length;){const e=t.events[l];"enter"===e[0]&&"table"===e[1].type&&(e[1]._align=o(t.events,l))}return e}}}};function d(e,t,n,i,a,l){const r=1===i?"tableHeader":2===i?"tableDelimiter":"tableData";0!==n[0]&&(l.end=Object.assign({},b(t.events,n[0])),e.add(n[0],0,[["exit",l,t]]));const s=b(t.events,n[1]);if(l={type:r,start:Object.assign({},s),end:Object.assign({},s)},e.add(n[1],0,[["enter",l,t]]),0!==n[2]){const a=b(t.events,n[2]),l=b(t.events,n[3]),r={type:"tableContent",start:Object.assign({},a),end:Object.assign({},l)};if(e.add(n[2],0,[["enter",r,t]]),2!==i){const i=t.events[n[2]],a=t.events[n[3]];if(i[1].end=Object.assign({},a[1].end),i[1].type="chunkText",i[1].contentType="text",n[3]>n[2]+1){const t=n[2]+1,i=n[3]-n[2]-1;e.add(t,i,[])}}e.add(n[3]+1,0,[["exit",r,t]])}return void 0!==a&&(l.end=Object.assign({},b(t.events,a)),e.add(a,0,[["exit",l,t]]),l=void 0),l}function c(e,t,n,i,a){const l=[],r=b(t.events,n);a&&(a.end=Object.assign({},r),l.push(["exit",a,t])),i.end=Object.assign({},r),l.push(["exit",i,t]),e.add(n+1,0,l)}function b(e,t){const n=e[t],i="enter"===n[0]?"start":"end";return n[1][i]}export{u as gfmTable,t as gfmTableHtml};